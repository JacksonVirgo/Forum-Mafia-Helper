(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{21:function(t,e,n){},22:function(t,e,n){},99:function(t,e,n){"use strict";n.r(e);var a=n(0),c=n(7),r=n(8),o=n(15),i=n(14),s=n(1),l=n.n(s),u=n(53),h=n.n(u),b=n(54),j=n(2),v=n.p+"static/media/logo.f16fac0d.png";n(21),n(22);function d(t){return Object(a.jsxs)("div",{className:"centerModal",children:[Object(a.jsx)("img",{src:v,alt:"Logo"}),Object(a.jsx)("h1",{children:"Mafia Engine"}),(e="Version Beta 1.2",e?Object(a.jsx)("h2",{children:e}):null),Object(a.jsx)("br",{}),Object(a.jsxs)("div",{className:"mainmenu",children:[Object(a.jsx)("a",{className:"menuoption",href:"/rolecard",children:"Role Card"}),Object(a.jsx)("a",{className:"menuoption",href:"/replacement",children:"Replacement Form"}),Object(a.jsx)("a",{className:"menuoption",href:"/votecount",children:"Vote Counter"}),Object(a.jsx)("a",{className:"menuoption",href:"/info",children:"Information"})]})]});var e}function f(){return Object(a.jsxs)("div",{className:"centerModal",children:[Object(a.jsx)("img",{src:v,alt:"Logo"}),Object(a.jsx)("h1",{children:"404"}),Object(a.jsx)("h2",{children:"Page Not Found"})]})}var g=n(37),m=n(27),p=n.n(m),O="http://mafiaengine.com";function y(){var t=p()(O);return t}var x=["January","February","March","April","May","June","July","August","September","October","November","December"];var k=function(t){Object(o.a)(n,t);var e=Object(i.a)(n);function n(){var t;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).socket=null,t.state={result:"",progress:""},t.cache={},t}return Object(r.a)(n,[{key:"addCache",value:function(t){this.cache=Object.assign(t)}},{key:"setCache",value:function(t){this.cache=t}},{key:"clearCache",value:function(){this.cache={}}},{key:"componentDidMount",value:function(){this.initSocketConnection(),this.setupSocketListeners()}},{key:"componentWillUnmount",value:function(){this.closeSocketConnection()}},{key:"initSocketConnection",value:function(){this.socket=p.a.connect()}},{key:"closeSocketConnection",value:function(){this.socket.disconnect()}},{key:"onClientDisconnect",value:function(){console.log("Disconnected from Server")}},{key:"onClientReconnect",value:function(){console.log("Reconnected to Client")}},{key:"setupSocketListeners",value:function(){this.addSocketListener("disconnected",this.onClientDisconnect.bind(this)),this.addSocketListener("reconnect",this.onClientReconnect.bind(this)),this.addSocketListener("ping",console.log)}},{key:"addSocketListener",value:function(t,e){this.socket.on(t,e)}},{key:"render",value:function(){return Object(a.jsx)("p",{children:"Blank Tool"})}}]),n}(l.a.Component);var S=function(){var t=Object(s.useState)(""),e=Object(g.a)(t,2),n=e[0],c=e[1],r=Object(s.useState)("F"),o=Object(g.a)(r,2),i=o[0],l=o[1],u=y();u.on("replacement",(function(t){return b(t)}));var h=null,b=function(t){console.log(t);var e=t.author,n=t.lastPage,a=t.title,r=t.url,o=function(){var t=new Date,e=t.getDate();e=function(t){var e=t%10,n=t%100;return 1===e&&11!==e?t+"st":2===e&&12!==n?t+"nd":3===e&&13!==n?t+"rd":t+"th"}(e);var n=t.getMonth()+1;return"".concat(e," ").concat(x[n-1])}(),i="".concat(o,"\n[i][url=").concat(r,"]").concat(a,"[/url][/i]\n[b]Moderator:[/b] [user]").concat(e,"[/user][tab]3[/tab][tab]3[/tab][b]Status:[/b] ").concat(n," pages [tab]3[/tab] [b]Replacing:[/b] [user]").concat(h,"[/user]");c(i)};return Object(a.jsxs)("form",{onSubmit:function(t){t.preventDefault();var e=t.target.gameThread.value;h=t.target.departingPlayer.value,u.emit("replacement",{url:e}),l("[pending]")},children:[Object(a.jsx)("label",{htmlFor:"gameThread",children:"Link to Game Thread"}),Object(a.jsx)("input",{id:"gameThread",name:"gameThread",type:"text"}),Object(a.jsx)("br",{}),Object(a.jsx)("label",{htmlFor:"departingPlayer",children:"Departing Player"}),Object(a.jsx)("input",{id:"departingPlayer",name:"departingPlayer",type:"text"}),Object(a.jsx)("br",{}),Object(a.jsx)("input",{type:"submit"}),Object(a.jsx)("br",{}),Object(a.jsxs)("h2",{children:["Result ",Object(a.jsx)("span",{value:i})]}),Object(a.jsx)("textarea",{name:"result",value:n,readOnly:!0})]})},C=function(t){Object(o.a)(n,t);var e=Object(i.a)(n);function n(t){var a;return Object(c.a)(this,n),(a=e.call(this,t)).title=t.title,a.child=t.child,a}return Object(r.a)(n,[{key:"render",value:function(){return Object(a.jsxs)("div",{className:"centerModal",children:[Object(a.jsx)("h1",{children:this.title}),Object(a.jsx)("br",{}),this.child]})}}]),n}(s.Component);function M(){return Object(a.jsx)(C,{title:"Replacement Form",child:Object(a.jsx)(S,{})})}function V(){var t=y();return Object(a.jsx)("form",{onSubmit:function(e){e.preventDefault(),t.emit("ping",{})},children:Object(a.jsx)("input",{type:"submit",value:"Submit"})})}function w(){return Object(a.jsx)(C,{title:"Vote Count",child:Object(a.jsx)(V,{})})}var N=n(28),F=n(56),L=n(16),U=n(20),D=function(){function t(e,n){Object(c.a)(this,t),this.category=n,this.author=e.author,this.pronoun=e.pronoun,this.number=parseInt(e.post.number),this.url=e.post.url,this.votes=e.votes,this.vote={last:null,valid:null}}return Object(r.a)(t,[{key:"isAfter",value:function(t){return this.number>t.number}},{key:"getNewest",value:function(t){return t?this.isAfter?this:t:this}},{key:"clean",value:function(t){for(var e=t.totalnames,n=t.alias,a=this.votes[this.category],c=void 0,r=void 0,o=a.length;o>=0;o-=1){var i=a[o];if(void 0===c&&(c=i),void 0===r&&(i||null===i))if(null===i)r=null;else{var s=Object(U.findBestMatch)(i,e).bestMatch;s.rating,null===t||void 0===t||t.correctionWeight;var l=n[s.target];l&&(r=l,c===i&&(c=r))}}this.vote.last=c,this.vote.valid=r}},{key:"isValid",value:function(t){var e,n=this.number>parseInt(t.days[t.days.length-1]),a=!1,c=Object(N.a)(t.dead);try{for(c.s();!(e=c.n()).done;){var r=e.value,o=this.rootUser(r,t.totalnames),i=this.rootUser(this.author,t.totalnames);o.target===i.target&&(a=!0)}}catch(s){c.e(s)}finally{c.f()}return n&&!a}},{key:"rootUser",value:function(t,e){return Object(U.findBestMatch)(t,e).bestMatch}}]),t}(),P=function(t){Object(o.a)(n,t);var e=Object(i.a)(n);function n(){var t;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).cache={},t}return Object(r.a)(n,[{key:"setupSocketListeners",value:function(){Object(F.a)(Object(L.a)(n.prototype),"setupSocketListeners",this).call(this),this.socket.on("votecount",this.onVoteCount.bind(this)),this.socket.on("progress",this.onProgress.bind(this))}},{key:"onVoteCount",value:function(t){this.addCache(t);var e=this.clean(),n=this.format(e);this.setState({progress:"",result:n})}},{key:"onProgress",value:function(t){var e=Math.round(t.currentPage/t.lastPage*100);this.setState({progress:"[".concat(e,"%]")})}},{key:"onFormSubmit",value:function(t){t.preventDefault();var e=t.target.gameUrl.value||"https://forum.mafiascum.net/viewtopic.php?f=2&t=85556";console.log(e),this.socket.emit("votecount",{url:e}),this.setState({progress:"[0%]"}),console.log("Form Submitted")}},{key:"render",value:function(){return Object(a.jsxs)("form",{onSubmit:this.onFormSubmit.bind(this),children:[Object(a.jsx)("label",{htmlFor:"gameUrl",children:"Link to Game Thread"}),Object(a.jsx)("input",{id:"gameUrl",name:"gameUrl",type:"text"}),Object(a.jsx)("br",{}),Object(a.jsx)("input",{type:"submit",value:"Generate"}),Object(a.jsx)("br",{}),Object(a.jsxs)("h2",{children:["Result ",Object(a.jsx)("span",{children:this.state.progress})]}),Object(a.jsx)("textarea",{name:"result",value:this.state.result,readOnly:!0})]})}},{key:"clean",value:function(){var t={votes:{},wagons:{},notVoting:[],majority:null};for(var e in this.cache.voteCount)for(var n in t.votes[e]||(t.votes[e]={}),t.wagons[e]||(t.wagons[e]={}),t.notVoting=this.getAlive(),t.majority=Math.ceil(t.notVoting.length/2),this.cache.voteCount[e]){for(var a,c=this.cache.voteCount[e][n],r=null,o=null,i=0;i<c.length;i++){var s=new D(c[i],e);s.clean(this.cache.settings),void 0!==s.vote.valid&&(o=s.vote.valid?s.getNewest(o):null),r=s.getNewest(r)}if(null===(a=o)||void 0===a?void 0:a.isValid(this.cache.settings)){var l=t.notVoting.indexOf(o.author);t.notVoting.splice(l,1),t.votes[e][n]={last:r,valid:o},t.wagons[e][o.vote.valid]||(t.wagons[e][o.vote.valid]=[]),t.wagons[e][o.vote.valid].push(o)}}return t}},{key:"format",value:function(t){var e=t.wagons,n=t.notVoting,a=t.majority,c="";for(var r in e){var o="[area]";for(var i in e[r]){for(var s=e[r][i],l="[b]".concat(i,"[/b] (").concat(s.length,") -> "),u=0;u<s.length;u++)u>0&&(l+=", "),l+="".concat(s[u].author);o+="".concat(l," [b][E-").concat(a-s.length,"][/b]\n")}if(n.length>0){o+="\n[b]Not Voting[/b] (".concat(n.length,") -> ");for(var h=0;h<n.length;h++)h>0&&(o+=", "),o+="".concat(n[h])}c+=o+="[/area]"}return c}},{key:"getAlive",value:function(){for(var t=this.cache.settings,e=t.players,n=t.dead,a=[],c=0;c<e.length;c++){var r=this.getRootAuthor(e[c]);R(r,a)||R(r,n)||a.push(r)}return a}},{key:"checkValid",value:function(t,e){var n,a=t.number>parseInt(this.cache.settings.days[this.cache.settings.days.length-1]),c=!1,r=Object(N.a)(this.cache.settings.dead);try{for(r.s();!(n=r.n()).done;){var o=n.value,i=this.rootUser(o),s=this.rootUser(t.author);i.target===s.target&&(c=!0)}}catch(l){r.e(l)}finally{r.f()}return a&&!c}},{key:"isValidVote",value:function(t){var e=!1;if(t){var n=this.rootUser(t);n.rating,this.cache.settings.correctionWeight,this.cache.settings.alias[n.target]&&(e=!0)}return e}},{key:"rootUser",value:function(t){return Object(U.findBestMatch)(t,this.cache.settings.totalnames).bestMatch}},{key:"getRootAuthor",value:function(t){var e=Object(U.findBestMatch)(t,this.cache.settings.totalnames).bestMatch;return this.cache.settings.alias[e.target]||e.target}}]),n}(k);function R(t,e){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}function A(){return Object(a.jsx)(C,{title:"Vote Count",child:Object(a.jsx)(P,{})})}var B=function(t){Object(o.a)(n,t);var e=Object(i.a)(n);function n(t){var a;return Object(c.a)(this,n),(a=e.call(this,t)).state={},a}return Object(r.a)(n,[{key:"render",value:function(){return Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(b.a,{children:Object(a.jsxs)(j.d,{children:[Object(a.jsx)(j.b,{exact:!0,path:"/",component:d}),Object(a.jsx)(j.b,{exact:!0,path:"/replacement",component:M}),Object(a.jsx)(j.b,{exact:!0,path:"/votecount",component:A}),Object(a.jsx)(j.b,{exact:!0,path:"/test",component:w}),Object(a.jsx)(j.b,{path:"/404",component:f}),Object(a.jsx)(j.a,{to:"/404"})]})})})}}]),n}(l.a.Component);h.a.render(Object(a.jsx)(B,{}),document.getElementById("root"))}},[[99,1,2]]]);
//# sourceMappingURL=main.6dc1f7dd.chunk.js.map